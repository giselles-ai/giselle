name: CI

on:
  push:
    branches: [main]
  pull_request:

jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v6
      - name: Setup Biome
        uses: biomejs/setup-biome@29711cbb52afee00eb13aeb30636592f9edc0088 # v2.7.0
        with:
          version: 2.0.6
      - uses: pnpm/action-setup@41ff72655975bd51cab0327fa583b6e92b6d3061 # v4.2.0
      - run: pnpm install
      - name: Set node version to 24.x
        uses: actions/setup-node@2028fbc5c25fe9cf00d9f06a71cc4710d4507903 # v6.0.0
        with:
          node-version: 24.x
          cache: "pnpm"
      - name: Run Biome
        run: biome ci .
      - run: pnpm knip
      - name: Build SDK
        run: pnpm build-sdk
      - run: pnpm check-types
      - name: Install ripgrep (rg)
        run: sudo apt-get update && sudo apt-get install -y ripgrep
      - name: Report Colors (non-blocking)
        run: pnpm report:colors
        continue-on-error: true
      - name: Save Report Colors JSON
        if: always()
        run: pnpm report:colors:out || true
      - name: Upload Report Artifact
        if: always()
        uses: actions/upload-artifact@v6
        with:
          name: report-colors
          path: .reports/report-colors.json
      - name: Guard Colors (non-blocking warnings with baseline)
        run: pnpm guard:colors -- --baseline .reports/report-colors.json || true
      - name: Lint Colors in Code (non-blocking)
        run: pnpm lint:colors:code || true
      - name: Test
        run: pnpm test
