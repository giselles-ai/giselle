# Continuity ledger (per-branch)

## Human intent (must not be overwritten)

<!--
Write 1–5 bullets capturing the human goal and motivation.
This section is intentionally stable: do not overwrite it when updating the ledger.
-->

- Add public SDK-side file upload support as the next step toward file inputs for the public Runs API.

## Goal (incl. success criteria)

- Add a public Studio endpoint to upload a file for an App via team secret-key auth and return `UploadedFileData`.
- Add matching `@giselles-ai/sdk` support (`client.files.upload`) with tests + docs.

## Constraints/Assumptions

- Keep implementation small and consistent with existing public endpoints (`/api/apps/[appId]/run`, `/api/apps/[appId]/tasks/[taskId]`).
- Do not leak `appId` existence to unauthenticated callers.
- Enforce a ~4.5MB upload cap (Vercel Functions body limit) and return a clear error message.

## Key decisions

- Return `{ file: UploadedFileData }` from the upload endpoint so callers have all metadata without a follow-up lookup.
- Keep the Runs API request body unchanged for now (`{ text: string }`); upload is preparatory for a later `{ text, fileId }` addition.

## State

- Before: SDK supported only `client.app.run()` / `runAndWait()` and explicitly rejected file input.
- After: SDK supports uploading a file to an App’s workspace via `client.files.upload(...)`, returning an `UploadedFileData` payload.

## Done

- Added public upload route: `POST /api/apps/[appId]/files/upload` (multipart/form-data) with auth + rate limit and `UploadedFileData` response.
- Added route unit tests with mocked DB/auth/giselle dependencies.
- Added SDK `client.files.upload()` implementation + tests + README docs.
- Added a copy-pastable SDK README example to upload `./receipt.pdf` via `client.files.upload(...)`.

## Now

- All todos from the plan are completed.

## Next

- Extend the Runs endpoint to accept file references (e.g. `{ text, fileId }`) and map it to the App’s first `files` parameter.

## Open questions (UNCONFIRMED if needed)

- Should the upload endpoint also accept `workspaceId` explicitly, or remain App-scoped only?
- Should we store server-side metadata for uploads (beyond returning it in the response) to support later listing?

## Working set (files/ids/commands)

- `apps/studio.giselles.ai/app/api/apps/[appId]/files/upload/route.ts`
- `apps/studio.giselles.ai/app/api/apps/[appId]/files/upload/route.test.ts`
- `packages/sdk/src/sdk.ts`
- `packages/sdk/src/sdk.test.ts`
- `packages/sdk/README.md`
- Tests: `pnpm -F @giselles-ai/sdk test`, `pnpm -F studio.giselles.ai test`

