# Continuity ledger (per-branch)

## Human intent (must not be overwritten)

- Reuse the same `GiselleClientProvider` wiring (server actions mapped to `GiselleClient`) across Studio pages like playground/tasks, without copy-pasting a huge mapping object.

## Goal (incl. success criteria)

- `useGiselle()` works in `(main)` routes (e.g. stage input file uploads) by having a single `GiselleClientProvider` mounted in the authenticated app shell.
- Workspace editor page (`app/workspaces/[workspaceId]`) continues to work, but reuses the shared client mapping.
- No duplicated “mappedClient” object across pages.

## Constraints/Assumptions

- Assume login-only; mount provider only under `app/(main)/layout.tsx` (do not touch root `app/layout.tsx`).
- Keep the change minimal and consistent with existing `@/lib/internal-api` server action exports.

## Key decisions

- Extract the mapping into `createInternalGiselleClient()` so both `(main)` layout and the workspace editor page share a single definition.

## State

- `useStageInput()` already calls `useGiselle()` and needs a `GiselleClientProvider` in-tree.

## Done

- Added `createInternalGiselleClient()` factory.
- Added `(main)`-scoped provider wrapper and mounted it in `app/(main)/layout.tsx`.
- Refactored workspace editor page to use the shared factory.

## Now

- Tooling note: this environment couldn’t run `pnpm biome` / `pnpm check-types` (no `pnpm`), so formatting/typecheck should be run locally.

## Next

- Run `pnpm biome check --write` on the touched files and a quick typecheck locally.

## Open questions (UNCONFIRMED if needed)

- Should we also mount `GiselleClientProvider` for non-`(main)` authenticated routes beyond the workspace editor page, or keep wrapping them case-by-case?

## Working set (files/ids/commands)

- `apps/studio.giselles.ai/lib/internal-api/create-giselle-client.ts`
- `apps/studio.giselles.ai/app/(main)/internal-giselle-client-provider.tsx`
- `apps/studio.giselles.ai/app/(main)/layout.tsx`
- `apps/studio.giselles.ai/app/workspaces/[workspaceId]/page.client.tsx`
- Command (local): `pnpm biome check --write <files...>`

